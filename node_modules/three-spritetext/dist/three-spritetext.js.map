{"version":3,"file":"three-spritetext.js","sources":["../src/index.js"],"sourcesContent":["import {\n  LinearFilter,\n  Sprite,\n  SpriteMaterial,\n  Texture\n} from 'three';\n\nconst three = typeof window !== 'undefined' && window.THREE\n  ? window.THREE // Prefer consumption from global THREE, if exists\n  : {\n  LinearFilter,\n  Sprite,\n  SpriteMaterial,\n  Texture\n};\n\nexport default class extends three.Sprite {\n  constructor(text = '', textHeight = 10, color = 'rgba(255, 255, 255, 1)') {\n    super(new three.SpriteMaterial());\n\n    this._text = `${text}`;\n    this._textHeight = textHeight;\n    this._color = color;\n    this._backgroundColor = false; // no background color\n\n    this._padding = 0;\n    this._borderWidth = 0;\n    this._borderRadius = 0;\n    this._borderColor = 'white';\n\n    this._strokeWidth = 0;\n    this._strokeColor = 'white';\n\n    this._fontFace = 'Arial';\n    this._fontSize = 90; // defines text resolution\n    this._fontWeight = 'normal';\n\n    this._canvas = document.createElement('canvas');\n\n    this._genCanvas();\n  }\n\n  get text() { return this._text; }\n  set text(text) { this._text = text; this._genCanvas(); }\n  get textHeight() { return this._textHeight; }\n  set textHeight(textHeight) { this._textHeight = textHeight; this._genCanvas(); }\n  get color() { return this._color; }\n  set color(color) { this._color = color; this._genCanvas(); }\n  get backgroundColor() { return this._backgroundColor; }\n  set backgroundColor(color) { this._backgroundColor = color; this._genCanvas(); }\n  get padding() { return this._padding; }\n  set padding(padding) { this._padding = padding; this._genCanvas(); }\n  get borderWidth() { return this._borderWidth; }\n  set borderWidth(borderWidth) { this._borderWidth = borderWidth; this._genCanvas(); }\n  get borderRadius() { return this._borderRadius; }\n  set borderRadius(borderRadius) { this._borderRadius = borderRadius; this._genCanvas(); }\n  get borderColor() { return this._borderColor; }\n  set borderColor(borderColor) { this._borderColor = borderColor; this._genCanvas(); }\n  get fontFace() { return this._fontFace; }\n  set fontFace(fontFace) { this._fontFace = fontFace; this._genCanvas(); }\n  get fontSize() { return this._fontSize; }\n  set fontSize(fontSize) { this._fontSize = fontSize; this._genCanvas(); }\n  get fontWeight() { return this._fontWeight; }\n  set fontWeight(fontWeight) { this._fontWeight = fontWeight; this._genCanvas(); }\n  get strokeWidth() { return this._strokeWidth; }\n  set strokeWidth(strokeWidth) { this._strokeWidth = strokeWidth; this._genCanvas(); }\n  get strokeColor() { return this._strokeColor; }\n  set strokeColor(strokeColor) { this._strokeColor = strokeColor; this._genCanvas(); }\n\n  _genCanvas() {\n    const canvas = this._canvas;\n    const ctx = canvas.getContext('2d');\n\n    const border = Array.isArray(this.borderWidth) ? this.borderWidth : [this.borderWidth, this.borderWidth]; // x,y border\n    const relBorder = border.map(b => b * this.fontSize * 0.1); // border in canvas units\n\n    const borderRadius = Array.isArray(this.borderRadius) ? this.borderRadius : [this.borderRadius, this.borderRadius, this.borderRadius, this.borderRadius]; // tl tr br bl corners\n    const relBorderRadius = borderRadius.map(b => b * this.fontSize * 0.1); // border radius in canvas units\n\n    const padding = Array.isArray(this.padding) ? this.padding : [this.padding, this.padding]; // x,y padding\n    const relPadding = padding.map(p => p * this.fontSize * 0.1); // padding in canvas units\n\n    const lines = this.text.split('\\n');\n    const font = `${this.fontWeight} ${this.fontSize}px ${this.fontFace}`;\n\n    ctx.font = font; // measure canvas with appropriate font\n    const innerWidth = Math.max(...lines.map(line => ctx.measureText(line).width));\n    const innerHeight = this.fontSize * lines.length;\n    canvas.width = innerWidth + relBorder[0] * 2 + relPadding[0] * 2;\n    canvas.height = innerHeight + relBorder[1] * 2 + relPadding[1] * 2;\n\n    // paint border\n    if (this.borderWidth) {\n      ctx.strokeStyle = this.borderColor;\n\n      if (relBorder[0]) { // left + right borders\n        const hb = relBorder[0] / 2;\n        ctx.lineWidth = relBorder[0];\n        ctx.beginPath();\n        ctx.moveTo(hb, relBorderRadius[0]);\n        ctx.lineTo(hb, canvas.height - relBorderRadius[3]);\n        ctx.moveTo(canvas.width - hb, relBorderRadius[1]);\n        ctx.lineTo(canvas.width - hb, canvas.height - relBorderRadius[2]);\n        ctx.stroke();\n      }\n\n      if (relBorder[1]) { // top + bottom borders\n        const hb = relBorder[1] / 2;\n        ctx.lineWidth = relBorder[1];\n        ctx.beginPath();\n        ctx.moveTo(Math.max(relBorder[0], relBorderRadius[0]), hb);\n        ctx.lineTo(canvas.width - Math.max(relBorder[0], relBorderRadius[1]), hb);\n        ctx.moveTo(Math.max(relBorder[0], relBorderRadius[3]), canvas.height - hb);\n        ctx.lineTo(canvas.width - Math.max(relBorder[0], relBorderRadius[2]), canvas.height - hb);\n        ctx.stroke();\n      }\n\n      if (this.borderRadius) { // strike rounded corners\n        const cornerWidth = Math.max(...relBorder);\n        const hb = cornerWidth / 2;\n        ctx.lineWidth = cornerWidth;\n        ctx.beginPath();\n        [\n          !!relBorderRadius[0] && [relBorderRadius[0], hb, hb, relBorderRadius[0]],\n          !!relBorderRadius[1] && [canvas.width - relBorderRadius[1], canvas.width - hb, hb, relBorderRadius[1]],\n          !!relBorderRadius[2] && [canvas.width - relBorderRadius[2], canvas.width - hb, canvas.height - hb, canvas.height - relBorderRadius[2]],\n          !!relBorderRadius[3] && [relBorderRadius[3], hb, canvas.height - hb, canvas.height - relBorderRadius[3]]\n        ].filter(d => d).forEach(([x0, x1, y0, y1]) => {\n          ctx.moveTo(x0, y0);\n          ctx.quadraticCurveTo(x1, y0, x1, y1);\n        });\n        ctx.stroke();\n      }\n    }\n\n    // paint background\n    if (this.backgroundColor) {\n      ctx.fillStyle = this.backgroundColor;\n      if (!this.borderRadius) {\n        ctx.fillRect(relBorder[0], relBorder[1], canvas.width - relBorder[0] * 2, canvas.height - relBorder[1] * 2);\n      } else { // fill with rounded corners\n        ctx.beginPath();\n        ctx.moveTo(relBorder[0], relBorderRadius[0]);\n        [\n          [relBorder[0], relBorderRadius[0], canvas.width - relBorderRadius[1], relBorder[1], relBorder[1], relBorder[1]], // t\n          [canvas.width - relBorder[0], canvas.width - relBorder[0], canvas.width - relBorder[0], relBorder[1], relBorderRadius[1], canvas.height - relBorderRadius[2]], // r\n          [canvas.width - relBorder[0], canvas.width - relBorderRadius[2], relBorderRadius[3], canvas.height - relBorder[1], canvas.height - relBorder[1], canvas.height - relBorder[1]], // b\n          [relBorder[0], relBorder[0], relBorder[0], canvas.height - relBorder[1], canvas.height - relBorderRadius[3], relBorderRadius[0]], // t\n        ].forEach(([x0, x1, x2, y0, y1, y2]) => {\n          ctx.quadraticCurveTo(x0, y0, x1, y1);\n          ctx.lineTo(x2, y2);\n        });\n        ctx.closePath();\n        ctx.fill();\n      }\n    }\n\n    ctx.translate(...relBorder);\n    ctx.translate(...relPadding);\n\n    // paint text\n    ctx.font = font; // Set font again after canvas is resized, as context properties are reset\n    ctx.fillStyle = this.color;\n    ctx.textBaseline = 'bottom';\n\n    const drawTextStroke = this.strokeWidth > 0;\n    if (drawTextStroke) {\n      ctx.lineWidth = this.strokeWidth * this.fontSize / 10;\n      ctx.strokeStyle = this.strokeColor;\n    }\n\n    lines.forEach((line, index) => {\n      const lineX = (innerWidth - ctx.measureText(line).width) / 2;\n      const lineY = (index + 1) * this.fontSize;\n\n      drawTextStroke && ctx.strokeText(line, lineX, lineY);\n      ctx.fillText(line, lineX, lineY);\n    });\n\n    // Inject canvas into sprite\n    if (this.material.map) this.material.map.dispose(); // gc previous texture\n    const texture = this.material.map = new three.Texture(canvas);\n    texture.minFilter = three.LinearFilter;\n    texture.needsUpdate = true;\n\n    const yScale = this.textHeight * lines.length + border[1] * 2 + padding[1] * 2;\n    this.scale.set(yScale * canvas.width / canvas.height, yScale, 0);\n  }\n\n  clone() {\n    return new this.constructor(this.text, this.textHeight, this.color).copy(this);\n  }\n\n  copy(source) {\n    three.Sprite.prototype.copy.call(this, source);\n\n    this.color = source.color;\n    this.backgroundColor = source.backgroundColor;\n    this.padding = source.padding;\n    this.borderWidth = source.borderWidth;\n    this.borderColor = source.borderColor;\n    this.fontFace = source.fontFace;\n    this.fontSize = source.fontSize;\n    this.fontWeight = source.fontWeight;\n    this.strokeWidth = source.strokeWidth;\n    this.strokeColor = source.strokeColor;\n\n    return this;\n  }\n}\n"],"names":["three","window","THREE","LinearFilter","Sprite","SpriteMaterial","Texture","text","textHeight","color","_text","_textHeight","_color","_backgroundColor","_padding","_borderWidth","_borderRadius","_borderColor","_strokeWidth","_strokeColor","_fontFace","_fontSize","_fontWeight","_canvas","document","createElement","_genCanvas","padding","borderWidth","borderRadius","borderColor","fontFace","fontSize","fontWeight","strokeWidth","strokeColor","canvas","ctx","getContext","border","Array","isArray","relBorder","map","b","relBorderRadius","relPadding","p","lines","split","font","innerWidth","Math","max","line","measureText","width","innerHeight","length","height","strokeStyle","hb","lineWidth","beginPath","moveTo","lineTo","stroke","cornerWidth","filter","d","forEach","x0","x1","y0","y1","quadraticCurveTo","backgroundColor","fillStyle","fillRect","x2","y2","closePath","fill","translate","textBaseline","drawTextStroke","index","lineX","lineY","strokeText","fillText","material","dispose","texture","minFilter","needsUpdate","yScale","scale","set","constructor","copy","source","prototype","call"],"mappings":"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"}